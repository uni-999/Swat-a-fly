<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ПОЛЗУНКИ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="bg-noise"></div>
  <main class="app">
    <header class="app-header">
      <h1>ПОЛЗУНКИ</h1>
      <p>Аркадная гонка змей: классика 1+3 бота и режим отладки 4 бота</p>
    </header>

    <section id="screen-main" class="screen active">
      <div class="panel menu-panel">
        <label class="menu-field" for="player-name-input">
          <span>Имя игрока (онлайн)</span>
          <input
            id="player-name-input"
            type="text"
            maxlength="24"
            autocomplete="nickname"
            placeholder="Введите имя"
          >
        </label>
        <button id="btn-offline" class="btn primary">Играть офлайн</button>
        <button id="btn-online" class="btn ghost">Играть онлайн</button>
        <button id="btn-leaderboards" class="btn ghost">Таблица лидеров</button>
        <button id="btn-rules" class="btn ghost">Правила</button>
        <button id="btn-settings" class="btn ghost">Настройки (скоро)</button>
      </div>
    </section>

    <section id="screen-leaderboard" class="screen">
      <div class="panel">
        <h2>Таблица лидеров</h2>
        <div class="online-room-actions">
          <label class="menu-field" for="leaderboard-track-select">
            <span>Трасса</span>
            <select id="leaderboard-track-select"></select>
          </label>
          <button id="leaderboard-refresh" class="btn ghost" type="button">Обновить</button>
        </div>
        <p id="leaderboard-status" class="mode-note">Выберите трассу и обновите таблицу.</p>
        <table class="results-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Игрок</th>
              <th>Трасса</th>
              <th>Лучшее время</th>
            </tr>
          </thead>
          <tbody id="leaderboard-body"></tbody>
        </table>
        <div class="actions">
          <button id="leaderboard-back" class="btn ghost">Назад</button>
        </div>
      </div>
    </section>

    <section id="screen-snake" class="screen">
      <div class="panel">
        <h2>Выбор змеи</h2>
        <div class="mode-switch">
          <button id="mode-classic" class="btn ghost">Классика: 1 игрок + 3 бота</button>
          <button id="mode-debug" class="btn ghost">Отладка: 4 бота</button>
        </div>
        <p id="mode-note" class="mode-note"></p>
        <div id="snake-cards" class="card-grid"></div>
        <div class="actions">
          <button id="snake-back" class="btn ghost">Назад</button>
          <button id="snake-next" class="btn primary" disabled>Дальше</button>
        </div>
      </div>
    </section>

    <section id="screen-track" class="screen">
      <div class="panel">
        <h2>Выбор трассы</h2>
        <div id="online-room-picker" class="online-room-picker" hidden>
          <label class="menu-field" for="online-room-select">
            <span>Комната (онлайн)</span>
            <select id="online-room-select">
              <option value="">Авто: подключиться или создать</option>
            </select>
          </label>
          <div class="online-room-actions">
            <input
              id="online-room-id-input"
              type="text"
              maxlength="64"
              autocomplete="off"
              spellcheck="false"
              placeholder="Или введите ID комнаты вручную"
            >
            <button id="online-room-refresh" class="btn ghost" type="button">Обновить список</button>
          </div>
        </div>
        <div id="track-cards" class="card-grid"></div>
        <div class="actions">
          <button id="track-back" class="btn ghost">Назад</button>
          <button id="track-start" class="btn primary" disabled>Старт</button>
        </div>
      </div>
    </section>

    <section id="screen-race" class="screen">
      <div class="race-layout">
        <div id="race-stage" aria-label="Игровое поле"></div>
        <div class="hud-overlay-layer" aria-hidden="true">
          <div class="hud-cluster hud-cluster--tl">
            <div class="hud-box hud-box--time">
              <span>Время</span>
              <strong id="hud-timer">00:00.000</strong>
            </div>
            <div class="hud-box hud-box--speed">
              <span>Скорость</span>
              <strong id="hud-speed">0 км/ч</strong>
            </div>
          </div>
          <div class="hud-cluster hud-cluster--tr">
            <div class="hud-box hud-box--position">
              <span>Позиция</span>
              <strong id="hud-position">P1/4</strong>
            </div>
            <div class="hud-box hud-box--effect">
              <span>Эффект</span>
              <strong id="hud-effect">нет</strong>
            </div>
          </div>
          <div class="hud-cluster hud-cluster--br">
            <div class="hud-box standings hud-box--standings">
              <span>Порядок</span>
              <ol id="hud-standings"></ol>
            </div>
          </div>
          <div class="hud-cluster hud-cluster--bl">
            <div class="controls">
              <p>Управление: W/A/S/D или стрелки</p>
              <p>R: рестарт трассы</p>
            </div>
          </div>
        </div>
      </div>
      <div id="race-overlay" class="race-overlay"></div>
    </section>

    <section id="screen-results" class="screen">
      <div class="panel">
        <h2>Результаты заезда</h2>
        <table class="results-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Участник</th>
              <th>Змея</th>
              <th>Финиш / прогресс</th>
            </tr>
          </thead>
          <tbody id="results-body"></tbody>
        </table>
        <div class="actions">
          <button id="results-retry" class="btn primary">Повторить</button>
          <button id="results-next" class="btn ghost">Следующая трасса</button>
          <button id="results-back" class="btn ghost">Назад</button>
        </div>
      </div>
    </section>

    <div id="toast" class="toast"></div>

    <div id="rules-modal" class="rules-modal" hidden>
      <div class="rules-modal__backdrop" data-rules-close></div>
      <section class="rules-modal__panel" role="dialog" aria-modal="true" aria-labelledby="rules-modal-title">
        <button id="rules-close" class="rules-modal__close" type="button" aria-label="Закрыть правила">×</button>
        <h2 id="rules-modal-title">Правила ПОЛЗУНКИ</h2>
        <p class="rules-modal__goal">
          Цель заезда: пройти <strong>3 круга</strong> и показать лучшее время.
        </p>
        <p class="rules-modal__goal">
          На старте есть короткий бриф, затем отсчёт <strong>3..2..1</strong> и GO.
        </p>
        <h3>Объекты на трассе</h3>
        <div class="rules-items-grid">
          <article class="rules-item rules-item--buff">
            <img src="/assets/sprites/items/boost.png" alt="BOOST">
            <div>
              <h4>BOOST</h4>
              <p>Скорость и разгон выше. Длительность: <strong>2.6 c</strong>.</p>
            </div>
          </article>
          <article class="rules-item rules-item--buff">
            <img src="/assets/sprites/items/shield.png" alt="SHIELD">
            <div>
              <h4>SHIELD</h4>
              <p>Блокирует один негативный удар. Длительность: <strong>6.5 c</strong>.</p>
            </div>
          </article>
          <article class="rules-item rules-item--buff">
            <img src="/assets/sprites/items/apple.png" alt="APPLE">
            <div>
              <h4>APPLE</h4>
              <p>+1 сегмент и короткий резкий рывок. Длительность буста: <strong>0.68 c</strong>.</p>
            </div>
          </article>
          <article class="rules-item rules-item--debuff">
            <img src="/assets/sprites/items/oil.png" alt="OIL">
            <div>
              <h4>OIL</h4>
              <p>Сложнее рулить, хуже разгон. Длительность: <strong>2.2 c</strong>.</p>
            </div>
          </article>
          <article class="rules-item rules-item--debuff">
            <img src="/assets/sprites/items/bomb.png" alt="BOMB">
            <div>
              <h4>BOMB</h4>
              <p>-1 сегмент и сильное замедление. Длительность: <strong>1.45 c</strong>.</p>
            </div>
          </article>
          <article class="rules-item rules-item--debuff">
            <img src="/assets/sprites/items/cactus.png" alt="CACTUS">
            <div>
              <h4>CACTUS</h4>
              <p>Шанс потери сегмента тела. Эффект мгновенный.</p>
            </div>
          </article>
        </div>
      </section>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/phaser@3.90.0/dist/phaser.min.js"></script>
  <script src="assets/vendor/colyseus.js"></script>
  <script type="module" src="script.js?v=20260216_rules_ui_1"></script>
</body>
</html>
