# Snake Drift Rush

Браузерная аркадная гонка змей (текущий этап: офлайн MVP + расширенная отладка).

## Текущее состояние

- Рендер и игровой цикл на `Phaser 3`.
- Переключаемые офлайн-режимы:
- `Классика`: `1 игрок + 3 NPC`.
- `Отладка`: `4 NPC` на автопилоте.
- Экраны: `Main Menu`, `Snake Select`, `Track Select`, `Race HUD`, `Results`.
- 3 уникальные трассы.
- 4 типа змей с разными характеристиками.
- 4 основных пикапа: `BOOST`, `SHIELD`, `OIL`, `BOMB`.
- Логика поверхности:
- `road` — обычное движение.
- `offroad` — заметное замедление (усилено).
- `outside` — сброс на последний чекпоинт + штраф по времени.
- Фазы заезда: `Countdown -> Running -> Finished`.
- Локальная таблица лучших времен по трассам (`localStorage`).

## Новые механики тела змеи

- У каждой змеи есть сегментированное тело.
- Тело извивается в движении.
- Для каждого типа змеи свой профиль извивки:
- разное число сегментов;
- разная амплитуда волны;
- разная частота и скорость волны;
- разная “толщина” хвоста.

## Дополнительные случайные объекты на трассе

- Добавлены рандомные `яблоки` и `кактусы`.
- Во время гонки они спавнятся в случайных точках на дороге и респавнятся после подбора.
- Эффект подбора:
- `яблоко` увеличивает длину тела;
- `кактус` уменьшает длину тела.
- Поведение NPC: по ходу движения NPC стараются подбирать `яблоки`, если они находятся впереди по траектории и в достижимом радиусе.

## Спрайты змей

- Поддерживается подключение спрайтов головы и сегментов тела для каждого типа змеи.
- Путь к файлам:
- `assets/sprites/snakes/speedster/head.png`
- `assets/sprites/snakes/speedster/segment.png`
- `assets/sprites/snakes/handler/head.png`
- `assets/sprites/snakes/handler/segment.png`
- `assets/sprites/snakes/bully/head.png`
- `assets/sprites/snakes/bully/segment.png`
- `assets/sprites/snakes/trickster/head.png`
- `assets/sprites/snakes/trickster/segment.png`
- Если у типа змеи спрайтов нет, автоматически используется текущий векторный рендер (игра не ломается).

## Влияние длины тела на эффекты

- При увеличении тела усиливаются полезные бафы (например, `BOOST`).
- При уменьшении тела ослабляются вредные эффекты (`OIL`, `BOMB_SLOW`).
- Текущая длина тела отображается в HUD рядом с активным эффектом.

## Управление

- `W/A/S/D` или стрелки — движение (в режиме `Классика`).
- `R` — быстрый рестарт текущей трассы.

## Размер игрового окна

- Игровая область (`race-stage`) увеличена примерно до `80%` окна браузера (адаптивно).

## Docker Compose стек

Проект собран в переносимый стек сервисов:

- `web` — фронтенд (Nginx, статика игры).
- `match-server` — Colyseus authoritative match-server.
- `nakama` — backend для leaderboard/RPC.
- `postgres` — база данных Nakama.

## Запуск через Docker (рекомендуется)

1. Скопировать переменные окружения:

```bash
cp .env.example .env
```

2. Поднять весь стек:

```bash
docker compose up --build
```

3. Сервисы будут доступны:

- Игра: `http://localhost:8080`
- Match-server health: `http://localhost:2567/healthz`
- Nakama API: `http://localhost:7350`
- Nakama Console: `http://localhost:7351`

4. Остановить стек:

```bash
docker compose down
```

Полный сброс с удалением тома БД:

```bash
docker compose down -v
```

## Как запустить

Рекомендуемый запуск — через локальный HTTP-сервер (так надежнее грузятся ассеты и спрайты).

1. Открыть терминал в корне проекта (`.../_hackathon`).
2. Запустить сервер одним из способов:

```bash
python -m http.server 5500
```

или

```bash
npx serve . -l 5500
```

3. Открыть в браузере `http://localhost:5500`.
4. Нажать `Play Offline`.
5. Выбрать режим (`Классика` или `Отладка`) и змею.
6. Нажать `Старт`.

Быстрый вариант для черновой проверки: можно открыть `index.html` напрямую, но для стабильной работы спрайтов и ассетов лучше использовать сервер.

## Правило по документации

- Все новые игровые механики и заметные изменения фиксируются в этом `README.md` сразу после реализации.
